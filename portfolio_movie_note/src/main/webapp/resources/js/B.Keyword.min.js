/*! Brunch-Web 2019-06-24 */
!function(a){var b="keywordArticleData3";window.B.Keyword={Common:{},windowHeight:a(window).height(),lastPublishTime:0,articleList:[],moreList:!0,keywordType:"",keywordParam:"",keyword:"",pickContentId:"",moreListLockFlag:!1,keywordListMinHeight:38,page:{},isRendering:!1,blockLoad:null,$wrapContents:a(".wrap_contents"),$wrapContentsProfile:a(".result_search"),$listProfile:a(".list_follow.search_writer"),$loadSpinner:a("#loadSpinner"),$keywordItemBlock:a("#keywordItemListBlock"),$moreButton:a("#moreBtn"),$moreButtonArrow:a("#moreBtnArrow"),$moreButtonText:a("#moreBtnTxt"),init:function(c,d){this.lastPublishTime=d,this.keyword=a("#keyword").val(),this.keywordType=a("#keywordType").val(),this.keywordParam=a("#keywordParam").val(),this.pickContentId=a("#pickContentId").val();var e=this;B.headerMenu.initScrollMenuForPage("keywordSub"),a(window).on("scroll",a.proxy(e.getMoreArticleByScroll,e)),a(window).on("beforeunload",a.proxy(function(){this.articleList&&this.articleList.length>0&&sessionStorage.setItem(b,JSON.stringify({articleList:this.articleList,moreList:this.moreList,keywordType:this.keywordType,keywordParam:this.keywordParam,pickContentId:this.pickContentId}))},this)),this.moreKeywordListInit(),this.handlebarsInit(),"profile"==this.keywordType?this.initUserList(this.keyword):this.initArticleList(c)},initArticleList:function(a){var b=this.getStoredData();b?this.getArticleListSuccess(b):a?this.getArticleListSuccess(a):this.getArticleList()},initUserList:function(){this.drawUserList(this.keyword,1),this.page.profile=1,a("#daumContent").css("min-height",a(document).height()-a(".wrap_search_header").height())},getProfileListSuccess:function(b){if(this.moreList=b.moreList,void 0===b.list||b.list.length<1)1==this.page.profile&&this.showEmptyArea();else{var c=this,d=c._splitList(a(".search_writer li"),b.list,".search_writer_info",2);B.Util.delayLoop(d,function(a,b){c.razyDrawCheck(d.length,b),c._appendProfile(a,c)},d.length,0,100)}this.moreListLockFlag=!1},_splitList:function(a,b,c,d){var e=[];if(a.length>0){var f=a.last().find(c).length;if(f<d){var g=d-f;e.push(b.slice(0,g)),b=b.slice(g,b.length)}}for(var h=0;h<b.length;h++){var i=h+d;i>b.length&&(i=b.length),e.push(b.slice(h,i)),h=i-1}return e},_appendProfile:function(b,c){var d=a("<li></li>"),e=a(".search_writer li").last();b.forEach(function(b){b.viewKeywords=!0;var f=a(B.Util.getTemplate("search-user-item.hbs",b));e.length>0&&e.find(".search_writer_item").length<2?e.append(f):d.append(f),d.find(".search_writer_item").length>0&&c.$listProfile.append(d);var g=!1,h="",i=0;f.find(".keyword_elem").each(function(){var b=a(this);if(b.html(b.text()),b.attr("href","/keyword/profile/"+encodeURIComponent(b.text().replace("<b>","").replace("</b>",""))),(i+=1*b.width()+1*b.css("padding-left").replace("px","")+1*b.css("padding-right").replace("px","")+1*b.css("margin-right").replace("px",""))>375)return void(g=!0);b.hasClass("btn_more")||(h+=this.outerHTML)});var j=f.find(".tab_keywords");j.empty(),j.append(a(h)),g&&(f.find(".keyword_list").addClass("has_more"),f.find(".keyword_list").append('<a href="/@'+b.profileId+'" class="keyword_elem btn_more"><span class="ico_brunch_v1 ico_more">더보기</span></a>'))})},getProfileListError:function(a){},drawUserList:function(b,c){this.moreListLockFlag=!0,B.Keyword.Common.getProfileList({keyword:b,page:c},a.proxy(this.getProfileListSuccess,this),a.proxy(this.getProfileListError,this))},moreKeywordListInit:function(){this.$keywordItemBlock.height()>this.keywordListMinHeight&&(a(".wrap_keywords").addClass("has_more"),this.$moreButton.click(a.proxy(this.moreButtonClick,this)))},moreButtonClick:function(){this.$moreButtonArrow.hasClass("fold")?(this.$moreButtonArrow.removeClass("fold"),this.$moreButtonText.text("더보기"),a(".wrap_keywords").animate({height:this.keywordListMinHeight+"px"},300)):(this.$moreButtonArrow.addClass("fold"),this.$moreButtonText.text("접기"),a(".wrap_keywords").animate({height:this.$keywordItemBlock.height()-7+"px"},300))},handlebarsInit:function(){Handlebars.registerHelper("brunchDate",function(a,b){if(a)return B.Util.brunchDate(a)}),Handlebars.registerHelper("isPickContents",function(a,b,c,d){return a==b+"_"+c?d.fn(this):d.inverse(this)}),Handlebars.registerHelper("if_all",function(){for(var a=[].slice.apply(arguments),b=a.pop(),c=b.fn,d=0;d<a.length;++d)if(!a[d]){c=b.inverse;break}return c(this)}),Handlebars.registerHelper("numberFormat",function(a){return isNaN(a)?a:B.Util.numberFormat(a)})},razyDrawCheck:function(a,b){return 0==a||a-1==b?("function"==typeof this.blockLoad&&this.blockLoad(),this.clearRazyDraw()):0==b&&(this.isRendering=!0),this.isRendering},clearRazyDraw:function(){this.isRendering=!1,this.blockLoad=null},getMoreArticleByScroll:function(b){if(this.moreListLockFlag)return!1;var c=a(window).scrollTop();if(a(document).height()<this.windowHeight+c+300&&!this.blockLoad)if(this.moreList){var d=a.proxy(function(){this.moreListLockFlag=!0,"profile"==this.keywordType?(this.page.profile=this.page.profile+1,this.drawUserList(this.keyword,this.page.profile)):this.getArticleList()},this);this.isRendering?this.blockLoad=d:d()}else this.$loadSpinner.hide()},getArticleList:function(){B.Keyword.Common.getArticleList({keywordType:this.keywordType,keywordParam:this.keywordParam,lastPublishTime:this.lastPublishTime,pickContentId:this.pickContentId},a.proxy(this.getArticleListSuccess,this),a.proxy(this.getArticleListError,this))},getStoredData:function(){var a=JSON.parse(sessionStorage.getItem(b));return a&&a.keywordType==this.keywordType&&a.keywordParam==this.keywordParam&&a.articleList&&a.articleList.length>0?a:null},getArticleListSuccess:function(b){var c=b.articleList;if(this.moreList=b.moreList,this.articleList=this.articleList.concat(c),this.moreList){if(c.length>=20){var d=c[c.length-1];this.lastPublishTime=+new Date(d.article.publishTime)}}else this.$loadSpinner.hide();var e=this;B.Util.delayLoop(c,function(b,d){if(e.razyDrawCheck(c.length,d),b&&b.article&&b.profile){var f=B.Util.getTemplate("keyword-article-item.hbs",{article:b.article,profile:b.profile,pickContentId:a("#pickContentId").val()});a(".list_article").append(f)}},c.length,0,100),0==c.length&&0==a(".list_article li").length&&this.showEmptyArea(),this.moreListLockFlag=!1},getArticleListError:function(a){alert(a),this.moreListLockFlag=!1},showEmptyArea:function(){var b="";if(1==a(".wrap_banner").size())var b=a(".wrap_banner").clone().wrapAll("<div/>").parent().html();var c=B.Util.getTemplate("alert.hbs",{alertWrapClass:"keyword",alertWrapTitle:"profile"==this.keywordType?"키워드를 선택한 작가가 없습니다.":"키워드로 발행된 글이 없습니다."});this.$wrapContents.html(b+c)}}}(jQuery),function(a){var b=B.Config.apiUrl,c={single:"/v1/top/keyword/",group:"/v1/top/keyword/group/",manual:"/v1/top/keyword/manual/",profile:"/v1/search/user"};window.B.Keyword.Common={getArticleList:function(a,d,e){B.Util.ajax({type:"get",url:b+c[a.keywordType]+a.keywordParam,data:{publishTime:a.lastPublishTime,pickContentId:a.pickContentId},success:function(a){"function"==typeof d&&d(a.data)},error:function(a){"function"==typeof e&&e(a)}})},getProfileList:function(a,d,e){B.Util.ajax({type:"get",url:b+c.profile,data:{keyword:a.keyword,page:a.page},success:function(a){"function"==typeof d&&d(a.data)},error:function(a){"function"==typeof e&&e(a)}})}}}(jQuery);